---
title: 黑苹果紫色屏幕问题
tags: []
categories:
  - 金融狗在假装码农
photos: []
author: Mr.K
top: 0
date: 2021-02-03 01:04:18
---

买了一台NUC，当时让卖家装好了win10和MAC系统，一开始测试都没有什么问题，但是...
<!-- more --> 因为想要用一个比较纯粹的linux系统来学习编程，所以自己又装了ubuntu20.04LTS版。装完之后，第一反应是发现mac系统进不去了，因为根本没有引导。后来这个问题通过refind解决了，但现在的引导界面非常丑，以后还得想想办法。

## 问题产生
今天主要说下能进入mac之后发生的一个很恶心的事情，那就是紫屏。这个问题主要出现在黑苹果以及mac外接显示器上。我的情况大致是这样，一开始启动mac系统的时候，屏幕颜色正常，然后进度条到1/3的地方，屏幕会闪一下，出来就紫色了。通过我昨晚搞定以后，我总结了一下这个问题的产生原因，我大致推测了一下，一开始启动mac的时候，屏幕的显示文件是由引导盘或者是底层的文件来支持的，但到进度条1/3左右的时候，苹果系统里的相应文件介入了，而这个文件对于显示器的支持有bug，所以就出现了这种问题。

## 解决方案
通过网上搜索，可以解决的方法，就是通过注入EDID信息之后，强制让mac以RGB色彩来解析给显示器。

## 解决步骤
### 生成一个EDID文件
**1. 首先下载从github一个[.rb](https://gist.githubusercontent.com/adaugherity/7435890/raw/66c54c17b179809b028b58a2ca7af0b9540d05b6/patch-edid.rb)文件**
**2. 打开终端，然后使用ruby命令运行该脚本。方法是输入ruby，再把这个文件拖进到Terminal。如下：**
```
ruby xxxxx/xxxx/patch-edid.rb
```
**3. 运行完毕后，在终端上会显示该生成的文件被存放的位置，找到它。建议先剪切到桌面即可。**
**4. 修改系统文件**
> 这步所有要做的，都是为了把生成的一个文件夹放到Mac系统文件夹中。我用的是Big Sur，从前某个版本的Mac开始，为了增强安全性，是无法通过直接挂载系统盘的方式修改系统文件的。
- **解决思路是: 将系统重新挂载在到一个有读写权限的新目录下，在该目录下操作即可。**（方法来自网络搜索，非原创）

- 进入系统Recovery模式，从terminal中将系统保护SIP关掉；我是黑苹果，用的opencore引导，在opencore界面按空格，就能看到Recovery盘了。进入恢复盘中的Terminal，输入以下两条命令
```
csrutil authenticated-root disable
csrutil disable
```


- 重启开机进入系统，可以在终端查看是否已将SIP关掉（csrutil status；csrutil authenticated-root status），都显示Disable即可；

- 通过 `sudo mount -o nobrowse -t apfs /dev/diskNsM /xxx/xx `重新将系统盘挂载到本地。/xxx/xx 是可以在任意地方新建的目录（例如：`/Users/mac/Desktop/aaa`）。diskNsM 为系统盘的设备名，这个在"磁盘工具-设备" 里可以看到（例如：disk1s5s1），注意要把后面的s1去掉，因为磁盘工具里面里显示的是系统盘的快照，挂载成这个snapshot是没用的！！
- 如果是上述例子的情况的话，就执行 `sudo mount -o nobrowse -t apfs /dev/disk1s5 /Users/mac/Desktop/aaa`，这样系统盘就重新挂载到了桌面的aaa文件夹下面，从这个文件夹进去就是系统根目录了。而且这个文件夹是可读可写的。

### 把EDID文件放入Mac系统文件夹
我们把之前放在桌面上的EDID配置文件夹，整个拖入`/System/Library/Displays/Contents/Resources/Overrides/`的系统配置文件夹。
如果提示覆盖之类，选是。同时为了保险起见，也可以先把原来的复制一下，以防万一。
### 重建snapshot
最后需要重建系统 snapshot，使用到的命令为：`sudo bless --folder /xxx/xx/System/Library/CoreServices --bootefi --create-snapshot`，其中/xxx/xx是最初设置的目录；如果是上述例子的情况的话，就执行：`sudo bless --folder /Users/mac/Desktop/aaa/System/Library/CoreServices --bootefi --create-snapshot`
### 重启
重启系统，再次重启进入Recovery模式，重新开启SIP以免系统失去安全防护。打开terminal，输入：
```
csrutil enable
csrutil authenticated-root enable
```

再次重启系统进入一般的Mac系统，会发现挂载的磁盘消失，而修改的设置已经写入到原先不能更改的系统文件中了。


**最重要的是，基佬紫消失！！！**
