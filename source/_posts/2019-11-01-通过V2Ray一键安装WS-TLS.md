---
title: 通过V2Ray一键安装WS+TLS
tags: [SS, V2Ray, GFW, ]
categories:
  - 金融狗在假装码农
abstract: 【】
message: 感谢浏览，本文内容已加密，请输入密码：
top: 0
timestamp: pt=1101133026
date: 2019-11-01 13:30:26
photos:
author: Mr.K
password:
---
由于国庆等不知名原因，我的小机场在很长一段时间里都用不来，家里的软路由也废在那边。
> 我的情况是Ping不通我的VPS。所以更加不用提什么科学上网了。

之后通过一个不太好用渠道，在油管上找了几个视频，学习了下什么是V2Ray，如何安装，什么是Websocket+TLS，如何弄，如何拯救我这种被墙掉的IP。下面就记录一下我自己折腾的过程。
<!--more-->
# 何为V2Ray
具体V2Ray是怎样一个东西，大家可以在科学上网以后去它的官网看看。我这里就讲讲我的粗糙的理解，它其实是一个集合的工具平台，它集合了例如SS、TCP、SOCKS5、MTProto等等。你可以理解成它就好比是一套瑞士军刀，上面很多的小工具都能让你转发你的浏览内容，对内容进行加密然后科学上网。这里，我们今天主要讲的是用Websocket+TLS的方式。

# WS+TLS方式
这个方式可能是目前相对比较安全的一种科学上网模式，它的逻辑是将你的访问，伪装成访问一个网站，并且我们通过TLS的模式，就相当于再一层加密。作为我们这个使用层面的玩家，理解这些就够了LOL

# 安装前的准备和要求
- 有一个境外的VPS【系统要求CentOS 7+、Debian 8+、Ubuntu 16+，作者更推荐Debian 9.】
- 有一个一级域名（后面会教你如何申请）
- VPS如果不能ping通，那么可能需要挂代理
- 一个Cloudflare账号，用于拯救被墙问题

# 主要步骤及思路
1、想办法ping通你的VPS（本文的前提是你已经能够连接上VPS了）
2、申请一个一级域名
3、往VPS里装入一键安装包，完成V2Ray安装（我用的是233一键安装版）
4、设置V2Ray模式为WS+TLS，并配置好
5、通过Cloudflare的CDN来绕开被墙问题，我们其实是在访问CF没有被墙的节点
6、可选配置：有一个DNSPod的账户，用于访问分流

## 配置步骤1：申请域名
1、我们这里申请一个免费域名。用的freenom（dot.tk也已经是freenom的一部分了）。申请freenom上的域名，步骤基本是很傻瓜式了，选择12个月的免费即可。另外，申请时候如果一直跳什么“不能认证你是个human”或者“技术错误”等。你就先用google或者Facebook之类登录以后，再申请就可以了。
2、申请完域名之后，如果你是选择DNSPod进行DNS配置的话，就从DNSpod里把它的Nameserver地址复制到freenom申请的域名下。如果直接用Cloudflare做DNS，那么添加了CF的NS以后，一定要把云从橘黄色点成灰色，DNS Only。
3、因为这个域名是新申请的，应该很快就能被DNSPod识别控制了。如果DNSPod还未识别，我们等等；如果不配置DNSPod，那可以直接在freenom中加入DNS设置，直接看第5步。
4、OK，现在这个域名已经被DNSPod识别了，就用这个时间进行DNS的配置（如果不加DNSPod，在freenom中也是一样进行配置）。DNSPod设置部分详见本文最后附加步骤。
5、首先，我们选择增加一个A记录，将它指向我们申请的VPS的IP地址。（在这里千万不要配置别的ip地址，因为会影响V2Ray的设置）
6、然后是等，等待这个DNS配置生效，一般在几分钟。方法是可以ping一下你的域名，是否已经指向你的VPS的IP地址。

## 配置步骤2：安装V2Ray
> 我用的是233一件安装版。如果你非要觉得有什么后门，欢迎自行研究用V2Ray的官网方法。

1、root账号登陆VPS，系统中需要有curl。一般也都有，如果没有输入下列命令
```
# CentOS：
yum update -y && yum install curl -y
# Debian/Ubuntu：
apt-get update -y && apt-get install curl -y
```
2、调整VPS时间为我们自己电脑的时间。这个是V2Ray的安装要求。输入以下命令
```
# 修改vps时区和时间
# 删除/etc/localtime
rm /etc/localtime
# 做软链
ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime

```

3、往系统里装入V2Ray。输入以下命令：
```
bash <(curl -s -L https://git.io/v2ray.sh)
```
这里系统会让你开始选择安装的模式，我们选4，Websocket+TLS。然后关于端口，就用默认的即可；关于域名，就输入我们申请的域名例如，`abc.tk`；是否要开启SS，我是选择了开启，因为有些设备SS会比较方便一些（默认是不开）。全部完成后，我们的VPS端就已经配置完毕了。

4、下载一个V2Ray的客户端，我以windows系统为例，我下载了V2RayN，其他的客户端方法大同小异。

## 配置步骤3：配置DNS，绕开被墙
1、在这一步，你需要一个Cloudflare账号，cloudflare有免费的套餐，可以使用它的CDN（可以理解成它的各种节点，镜像备份你的网站或者VPS了）。
2、我从油管一位大神那儿看了视频，他介绍了如何利用CNAME介入cloudflare，从而可以选择CF的节点位置。我这里就文字介绍一下。需要使用到CF的partner。他推荐了一个[https://cdn.moeelf.com/](https://cdn.moeelf.com/)，用CF账号登陆即可。我在后文的附加步骤里具体介绍。[跳转至后文](aaa)
3、通过CF官网登录你的账号，进去，应该已经可以看到你的网站了，一定要将TLS那里点成FULL。把前面点灰色的云点成橘黄色，即DNS+TLS。

## 开启BBR或锐速（二选一）
在VPS中输入
```
v2ray bbr
```
然后选择安装即可。不过我们如果是这种CDN绕道的方法下，这个开启后提速不明显，因为主要的速度受限在于CF的CDN速度和节点。

---
OK，截至这里，你的V2Ray已经建立完毕了。你可以到你的各个设备上愉快的配置了。

---
# 【附加】关于使用CF partner及DNSPod
提供如下两个网站供使用：
> 查看CF各线路的情况：[https://ofvps.com/201907510](https://ofvps.com/201907510)
> CF Partner：[https://cdn.moeelf.com/](https://cdn.moeelf.com/)
> 查看traceroute的一个网站：[https://tools.ipip.net/traceroute.php](https://tools.ipip.net/traceroute.php)

1、首先，现在DNS这里加入你的域名。如果你是直接从前面配置步骤3跳过来的，那请注意，一定一定要把那朵云点成灰色的。
尽管CF partner这里我们实际并不使用它的DNS功能，但还是需要告诉它我们的中心IP是哪里，所以要添加一个A记录。
```
添加DNS  @  A记录  填写你的VPS的IP
```
2、添加DNS之后，就会产生一个CNAME，我们把这个CNAME复制到DNSPod中。把之前在DNSPod中添加的那个指向VPS的IP的A记录删除掉或者暂停掉。
```
@  CNAME  【线路】默认    填写记录值（复制的那个值）
```
3、再根据你的需求去选择联通、移动、境内的各个线路。这里就需要用到我提供的CF线路查询的网站记录内容了。我建议是可以先用站长工具ping一下或者用TraceRoute查一下，这条线路到底是如何跳转的。选择最适合你的节点信息。
```
@   A     移动     xxxx        cloudflare的服务器IP
```