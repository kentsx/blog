---
title: 通过ZeroTier One内网穿透
tags: [OpenWRT]
categories:

  - 金融狗在假装码农
photos: []
author: Mr.K
top: 0
date: 2021-02-28 22:49:17
---
折腾完了OP，现在我的OP已经下挂了NAS，里面的Docker跑着Jellyfin以及HASS，在局域网已经可以使用了。但是作为一个爱折腾的人，怎么会满足于只能在内网使用呢，尤其是知道OP支持很多的外网访问方式，主要有DDNS、FRP等。

<!-- more --> 
但是我有个非常尴尬的场景，尽管我有公网IP，但是无奈我不想去改光猫的桥接，而且也懒得弄FRP，毕竟还得弄个服务器在外头跑。所以折中以后我发现可以用ZeroTier One来实现这个目标，唯一的缺陷就是每台设备都需要接入VPN，但办法总比困难多，后面写怎么搞定。

# ZTO的逻辑
其实ZTO并没有直接实现内网穿透，它主要是实现了异地组局域网的功能，这也就是为什么登陆时候会出现一个VPN的连接。它把你的设备通过后端的服务器，实现了一个异地局域网，这样就可以外网访问了。这也是为什么每个客户端都需要安装ZTO Client的原因。
[ZTO官网](https://www.zerotier.com/)

#ZTO使用
## 注册
这步就不提了吧，反正用免费的账号可以部署3个内网，每个内网可以有50个端口，应该对于个人的使用是足够了。下面主要就写如何配置和使用。
## 网页配置
注册以后，ZTO自动已经建了一条线路了。这里的NETWORK ID是关键，后面会经常要用到。点击进入。
![线路界面](https://s3.ax1x.com/2021/02/26/6SCtc6.jpg)
进入之后，看到一大堆，不用慌，最终其实没几个要配置的。我具体说下：
```
NAME（选配）：这条线路的名字，可以随意命名，主要是为了好记

DESCRIPTION（选填）：描述，也是为了之后能知道这条线路是干什么用的，自行发挥

ACCESS：一般选PRIVATE，就是私有，也就是只有你授权之后才能连入；PUBLIC就表示有你
NETWORK ID的人都能接入这个局域网，慎重！！！

MANAGE ROUTES: 稍后写，但如果你每个设备都单独接入，可以不管，默认即可。

IPv4 Auto-Sign：这里是选择你喜欢的IP地址段，根据个人喜好选择即可。比如我选了"192.168.191.*"，
表示我之后各设备都是的局域网IP前三段都是一样的，第四段会随机分配

Members：这里是核心部分，因为你选了PRIVATE，所以每个连入的设备都需要到网页来授权才行，
也就是Auth？下的选择框，打勾选上表示同意，前面会变绿，且后面能看到设备分配的IP，不打勾，
即使别人有你的NETWORK ID，连接进来了，也是显示红色的，不会被真的接入。这也是为什么要尽
可能在Access那里选私有的原因，谁都不希望随便被接入内网吧。
```
![配置界面](https://s3.ax1x.com/2021/02/26/6SCY1x.jpg)
## 客户端使用（以windows为例）
安装完客户端以后，打开，会在状态栏右下角出现一个ZTO的LOGO：
![WIN-ZTO](https://s3.ax1x.com/2021/02/28/6C70V1.jpg)
点击这个LOGO，选择Join Network（也就是加入网络），会跳出来一个对话框
![ZTO-加入](https://s3.ax1x.com/2021/02/28/6C7jZn.jpg)
把你的NETWORK ID填进去，点Join
![ZTO-连接](https://s3.ax1x.com/2021/02/28/6C7Oqs.jpg)
这时候，你只是已经配置好了网络，但还没有真的连接，再点一下LOGO，这时候你会看到刚刚加入的网络名字，点一下。如果Win跳出来问你什么专有网络，点是即可。Done，你现在已经连接了这个VPN局域网了。
如果你选的是Public，那已经可以访问了，
如果是选的Private，那回到网页。刷新一下，应该就能看到有一个连接请求信息（一个红色的NODE），在Auth前面勾选，即可。
![!](https://s3.ax1x.com/2021/02/26/6S9yOU.jpg)
就是这么简单，你已经接入了局域网。
iOS好像已经被下架了，安卓的在Google Play可以下载到，连不了谷歌的，想办法吧~

每个要连接的设备都需要下载客户端。

## OpenWRT的配置
一般来说，个人用的OP应该都不会是原版吧。比如我用的这版，自带了ZeroTier One。直接在框框里填上NetworkID，勾选启用，保存应用就配置好了。当然Private记得要去网页授权。
![OpenWRT设置](https://s3.ax1x.com/2021/02/28/6CHlsH.jpg)

## ZTO的设备访问
配置妥当以后，你可以用网页上Memebers模块下Managed IPs里看到每台接入设备的IP地址，用这个IP就可以访问啦。

# 小小升级一点
那你都连了OpenWRT了，也就是路由器都已经挂载了，难道每个接入这个路由器的设备都要再装个客户端？万一装不了呢？比如我的铁威马NAS，虽然Docker里能装ZTO，但是没法配置，也就一直连不上了。别急，这里就写下局域网内设备怎么直接被访问。其实也很简单，只要在ZTO 网页上，对Managed Routes那里一行配置即可，写完submit。如图：
```
Destination：填写上OP的网段，如我的OP是192.168.2.1，就写上192.168.2.0/24，
表示这个192.168.2.*所有IP

via：把ZTO分配给OP的IP填进去即可
```
![!](https://s3.ax1x.com/2021/02/26/6SCJ91.jpg)
意思就是，所有接入局域网设备要访问的地址，都会通过via后的IP，转访问。我的简单理解就是映射。

搞定啦，之后的访问就如同在家里局域网一般，直接输内网ip就可以了。比如我要访问我的Jellyfin，就直接输192.168.2.xxx:8096。不在家时候，也可以直接访问哦。
