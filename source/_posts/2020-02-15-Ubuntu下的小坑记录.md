---
title: Ubuntu下的小坑记录
tags: [coding, Ubuntuu]
categories:
  - 金融狗在假装码农
photos: []
author: Mr.K
top: 0
date: 2020-02-15 22:50:52
---
今天早上起床继续折腾我的coding之旅。

<!-- more --> 
对了，我推荐一个还不错的项目，叫QuantEcon，他们有本lecture notes还不错，官网是[QuantEcon.org](https://quantecon.org/)。
Python版的课程在[https://quantecon.org/quantecon-py/](https://quantecon.org/quantecon-py/)，感兴趣的话可以自己找找。说实话，看这里面的内容发现自己真的是把太多本科和硕士的内容给忘了。惭愧。

说回到Ubuntu，这个系统是开源的，不存在需要盗版的问题。另外，基于Linux的框架，给了他天然的适合Geek的基础特征（Case Sensitive）。我主要就罗列下我遇到的几个bug和如何解决的。
## Synaptic
我发现装这个真的还是挺有必要的，有时候处理不好dependency的时候，不断盲目`sudu apt-get `不如去用这个。

## 换源选对版本
在国内的小伙伴普遍的问题，应该都是apt真的很慢。换源，不管是用清华的、阿里的还是别家，但一定要对应版本。比如LTS 18.04。我一开始换成了LTS16的源，一直报错。。。而且导致很多包无法安装。
```
xxxxx held broken packages.xxxxx
```
类似这样的错误。很可能就是源有问题，更新源，然后`sudo apt-get update`；或者用Synaptic的也没问题。

## pip install
因为Ubuntu自带的python是2.7的，而越来越多的人转向python3；你可以坚持py2，但至少你需要在电脑上安装一个Py3。也这个因为自带的，它的pip版本比较低，应该是9.x，现在最新的已经是20.x了。直接用`pip install --upgrade pip`之后，大概率你会出现一个错误大致如下：
```
pip was invoked by an older version xxxxx, python -m pip  xxxxx
```
这一大段里面还会给你一个github issue链接：[https://github.com/pypa/pip/issues/5599](https://github.com/pypa/pip/issues/5599)。看了一下，作者的意思大概就两点：
1. 这是python的问题，和pip无关，你们要受得了就一直用`python -m pip`就可以了。
2. 谁让你们手贱自己用pip install --upgrade，这些涉及系统权限、覆盖的问题，不能这样。

这个坑也是够了。这个在Linux上应该都存在，因为自带python的缘故，往往自带的权限比较高。

我的建议，先`python -m pip uninstall pip`，回退到原来的9.x，先用着再说吧。
### 更新源可能也能解决这个问题
我更新了apt源之后，再去shell中直接`pip -V`，就不报错了。


## tkinter问题
我建了一个虚拟环境，想做些数据分析的活，奈何有出bug，
```
matplotlib is using agg, which is a non-GUI xxxxxx
```
对，就是画图，不能出图。查了下，问题出在backend上。我想去Synaptic上安装python3-tk，结果就出现了`held broken packages`的问题。我才知道我的源bug了。修整好，安装了python3-tk，虚拟环境中还是不行，外面已经可以了。这时候一个很奇妙的步奏，如下：
```
虚拟环境中
pip uninstall matplotlib
卸完，再装
pip install matplotlib
```
然后问题解决。LOL
## python3作为默认版本

直接执行这两个命令即可：
```
sudo update-alternatives --install /usr/bin/python python /usr/bin/python2 100

sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 150
```

如果要切换到Python2, 执行：
```
sudo update-alternatives --config python
```
按照提书输入选择数字回车即可

关于这个问题，我最后用了alternatives而不是alias，stackoverflow还有专门讨论。[https://stackoverflow.com/questions/41986507/unable-to-set-default-python-version-to-python3-in-ubuntu](https://stackoverflow.com/questions/41986507/unable-to-set-default-python-version-to-python3-in-ubuntu)

## python -m venv
这个问题至今还是bug一样的存在，我不知道出在哪。我的python是3.6.9的，但是我在跑`python -m venv`时，就会提示要我安装`apt-get python3-venv`，ok，我装了，然后还是报错。最后我还是用了`virtualvenv`了。


